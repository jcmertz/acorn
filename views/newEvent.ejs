<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.14.0/jquery-ui.min.js"></script>
</head>
<body>
    <h1>NEW EVENT REQUEST</h1>
    <p>New Event Request For: <%= bandName %> on <%= month %>/<%= day %>/<%= year %>  </p>
    <form action="/addEvent" id="newEventForm">
        <input type="hidden" id="band0" name="band0" value="<%= bandName %>"><br>
        <input type="hidden" id="bandCount" name="bandCount" value="1"><br>
        <input type="button" class="addBand" value="Add Band" onClick="updateForm();"> <br>
        <input type="checkbox" id="isMatinee" name="isMatinee value="isMatinee>
        <label for="isMatinee"> Check this box if you'd like a Matinee</label><br>
        <input type="hidden" name="showDate" value="<%= month %>/<%= day %>/<%= year %>"/>
        <input id="reqDate" type="hidden" name="reqDate"/>
        <input type="submit">	
    </form>
    <datalist id="knownBands">
        <% 
        var dataObj = knownBands;
        %>
        <%
        for ( let singleItem of dataObj ) {
            %>
            <option value='<%= singleItem %>'>
                <%
            }
            %>
        </datalist>
        <script>
            var date = new Date().toLocaleDateString();
            document.getElementById("reqDate").setAttribute("value",date);
            function updateForm(){
                bandCount = $('#bandCount').val();
                console.log(bandCount);
                var newBand = document.createElement("input");
                newBand.setAttribute("type", "text");
                newBand.setAttribute("id", "band"+bandCount);
                newBand.setAttribute("name", "band"+bandCount);
                newBand.setAttribute("list", "knownBands");
                newBand.setAttribute("autocomplete","off");
                var bandX = document.createElement("input");
                bandX.setAttribute("type", "button");
                bandX.setAttribute("value", "X");
                bandX.setAttribute("id", "otherBandX"+bandCount);
                bandX.setAttribute("onClick", "deleteBandField("+bandCount+")");
                if(bandCount == 1){
                    $('.addBand').after("<div id=div"+bandCount+">");
                    }else
                    {
                        $('#div'+(bandCount-1)).after("<div id=div"+bandCount+">");
                        }
                        $('#div'+bandCount).append(newBand,bandX);
                        bandCount++;
                        $('#bandCount').val(bandCount);
                    }
                    function deleteBandField(bandNum){
                        bandCount = $('#bandCount').val();
                        $('#div'+bandNum).remove();
                        for(i = bandNum+1; i < bandCount; i++){
                            newNum = i-1;
                            $('#otherBand'+i).attr("id", "band"+newNum);
                            $('#otherBand'+i).attr("name", "band"+newNum);
                            $('#otherBandX'+i).remove();
                            var bandX = document.createElement("input");
                            bandX.setAttribute("type", "button");
                            bandX.setAttribute("value", "X");
                            bandX.setAttribute("id", "otherBandX"+newNum);
                            bandX.setAttribute("onClick", "deleteBandField("+newNum+")");
                            $('#div'+i).append(bandX);
                            $('#div'+i).attr("id", "div"+(i-1));
                        }
                        bandCount--;
                        $('#bandCount').val(bandCount);
                    }
                    
                </script>
            </body>
            </html>
            