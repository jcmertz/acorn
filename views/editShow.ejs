<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.14.0/jquery-ui.min.js"></script>
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
  <link rel="stylesheet" href="../../styles/styles.css"/>
</head>
<body>
  <a href="/logout"><h3> LOGOUT </h3></a>
  <a href="/admin/"><h3> BACK </h3></a>
  <div class="row">
    <div class="column">
      <h1>Show Details</h1> 
      <p>Band: <%= show.contactBand.bandName %> </p>
      <p>Date: <%= show.showDate.toLocaleDateString() %>  </p>
      <p>Show Status: <%= show.showStatus %>  </p>
      
      <form id="form" action="/admin/setShowStatus" method="get">
        <input type="hidden" name="id" value="<%= show._id %>"/>
        <select id=status name='showStatus' onchange='if(this.value != "<%= show.showStatus %>") { this.form.submit(); }'>
          <option value='-1'>Rejected/Canceled</option>
          <option value='0'>Submitted, Not Responded To</option>
          <option value='1'>In Negotiation</option>
          <option value='2'>Confirmed</option>
        </select>
      </form>
    </div>
    <div class="column">
      <h2>Messages</h2>
      <ul id="messages">
        <% show.messages.map((msg)=>{ %>
          <li>
            <%= msg.user+": "+msg.msg %>
          </li>
          <% }) %>
        </ul>
        <form id="messageForm">
          <input type="text" id="messageBox"/>
          <input type="submit" value="Send"/>
        </form>
      </div>
    </div>
    
    <script> 
      $("#status").find('option[value="<%= show.showStatus %>"]').attr('selected','selected');
    </script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      var socket = io();
      
      
      var form = document.getElementById('messageForm');
      var input = document.getElementById('messageBox');
      
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        if (messageBox.value) {
          var out = {
            message:messageBox.value,
            id:'<%= show._id %>',
            user:"The Fallen Log"
          };
          socket.emit('message', out);
          messageBox.value = '';
        }
      });
      
      socket.on('message:<%= show._id %>', function(msg) {
        var item = document.createElement('li');
        item.textContent = msg;
        messages.appendChild(item);
      });
    </script>
  </body>
  </html>
  
  <!-- 
  Show Status:
  -1 - Rejected or Cancelled
  0 - Submitted, not responded to
  1 - In Negotiation
  2 - Confirmed 
  -->
  